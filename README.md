# Docker Wordpress Local Build Environment
This is a repository meant for dropping source-controlled Wordpress themes into and running on Docker in a local development environment. Specifically we use Docker Compose. This repository is based on the repository  at [github.com/nezhar/wordpress-docker-compose](https://github.com/nezhar/wordpress-docker-compose) with MariaDB and a container for Cypress.

## Installation
1. Download and unzip this repository onto your local machine and make it the root of your IDE project.
2. Clone a Git-tracked theme repository into the **repo** directory. The theme repository that you clone into this directory will be tracked in Git.
3. Dump and overwrite a full database .sql file from an appropriate staging environment as **sample-db.sql** in the **wp-data/db** directory. This will be the database that your local instance starts from. When creating the dump, make sure that you export both data and structure. Also make sure that your dump does not contain a "create database" statement.
4. Update the **.env** file making the REPO environment variable equal the name of your theme repository exactly as it now appears in your **repo** directory and making the THEMENAME equal the name of your main theme directory (assuming the theme directory is not the root of your theme repository).

## Running
1. The first time you run your Docker project, Docker will create containers for Wordpress (running on Apache+PHP), MariaDB, WP-CLI, PhpMyAdmin, and Cypress. You will have a Docker container for each of these.
2. The first time Docker creates the container for Wordpress, it will install files for a full Wordpress installation in the **wp-app** directory with mappings from the **repo** and **wp-plugins** directories. Once the Wordpress container is running, you can access the site at [http://127.0.0.1](http://127.0.0.1). For simplicity's sake, we are running on http.
3. When Docker creates the container for MariaDB, it will load your **sample-db.sql** files into the database. Once the database connection is made, you can view the database either through the PhpMyAdmin container that Docker installs by navigating to [http://127.0.0.1:8080](http://127.0.0.1:8080), or by connecting to it with another MySQL client like SQLyog. The username is "root" and the password is "password". These can be changed in the .env file if necessary.
4. The purpose of the WP-CLI container is for installing and updating Wordpress plugins and updating the Wordpress core. This containers built-in startup routine will probably fail to run the first time you run your Wordpress application because it takes a while for the Wordpress container to download all the necessary WP core files. However, on subsequent runs, WP-CLI will update the core and plugins. Once WP-CLI finishes its update routine, its container will shut down. You can rerun its routine during development by simply rerunning its container.
5. Some plugins are not accessible via WP-CLI. These will either need to be updated from within Wordpress admin while running the application, or with full plugins placed in the **wp-plugins** directory..
6. Cypress-related files are in the **e2e** directory. When you start your application, Cypress will automatically run through all tests in the **integration** directory. Once you it completes, you can see test results in the Cypress container's terminal window. Once Cypress finishes its testing routine, its container will shut down. You can rerun its tests anytime during development by simply rerunning its container.
7. Running your app will create artifacts (eg, API call logs, error logs). Each theme repository should have these types of artifacts listed in their .gitignore file, so they will not register as files that need to be committed.